-- MM2 Auto Farm Coin & EXP v·ªõi Rayfield Menu
-- Ho·∫°t ƒë·ªông trong M·ªåI MODE c·ªßa Murder Mystery 2 (UniverseId: 66654135)
-- FIX L·ªñI PLACEID - B√¢y gi·ªù ch·∫°y ƒë∆∞·ª£c ·ªü Classic, Disguises, Assassin,...
-- Toggle Auto Farm Coins & GodMode qua GUI ƒë·∫πp

local UniverseId = game.GameId
local MM2Universe = 66654135
if UniverseId ~= MM2Universe then
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "L·ªói";
        Text = "Ch·ªâ ho·∫°t ƒë·ªông trong Murder Mystery 2!";
        Duration = 5;
    })
    return
end

local PlaceId = game.PlaceId  -- Gi·ªØ PlaceId hi·ªán t·∫°i ƒë·ªÉ Rejoin ƒë√∫ng mode

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
    Name = "MM2 Auto Farm by Grok",
    LoadingTitle = "ƒêang load...",
    LoadingSubtitle = "Auto Coin & EXP - M·ªçi Mode",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MM2FarmGrok",
        FileName = "RayfieldConfig"
    },
    KeySystem = false
})

local Tab = Window:CreateTab("Main", 4483362458) -- Icon MM2

-- Variables
getgenv().AutoFarmCoins = false
getgenv().GodMode = false
local player = game.Players.LocalPlayer
local GodModeConnection

-- Function apply GodMode
local function applyGodMode(char)
    local humanoid = char:WaitForChild("Humanoid", 5)
    if humanoid and getgenv().GodMode then
        humanoid.MaxHealth = math.huge
        humanoid.Health = math.huge
    end
end

-- Function remove GodMode
local function removeGodMode(char)
    local humanoid = char:FindFirstChild("Humanoid")
    if humanoid then
        humanoid.MaxHealth = 100
        humanoid.Health = math.huge -- Keep full health but normal max
    end
end

-- Auto Farm Coins Loop
spawn(function()
    while wait(0.1) do
        if getgenv().AutoFarmCoins and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            for _, v in pairs(workspace:GetDescendants()) do
                if v.Name == "CoinContainer" and v:FindFirstChild("Coin_Server") and v.Coin_Server:FindFirstChild("Coin") then
                    local hrp = player.Character.HumanoidRootPart
                    hrp.CFrame = v.Coin_Server.Coin.CFrame * CFrame.new(0, 3, 0)
                    firetouchinterest(hrp, v.Coin_Server.Coin, 0)
                    wait()
                    firetouchinterest(hrp, v.Coin_Server.Coin, 1)
                end
            end
        end
    end
end)

-- GodMode Toggle
Tab:CreateToggle({
    Name = "GodMode (Farm EXP an to√†n)",
    CurrentValue = false,
    Flag = "GodModeToggle",
    Callback = function(Value)
        getgenv().GodMode = Value
        if Value then
            -- Connect event
            if GodModeConnection then GodModeConnection:Disconnect() end
            GodModeConnection = player.CharacterAdded:Connect(applyGodMode)
            -- Apply current
            if player.Character then applyGodMode(player.Character) end
            Rayfield:Notify({Title = "GodMode", Content = "B·∫≠t!", Duration = 2})
        else
            -- Disconnect v√† remove
            if GodModeConnection then GodModeConnection:Disconnect() end
            GodModeConnection = nil
            if player.Character then removeGodMode(player.Character) end
            Rayfield:Notify({Title = "GodMode", Content = "T·∫Øt!", Duration = 2})
        end
    end
})

-- Auto Farm Coins Toggle
Tab:CreateToggle({
    Name = "Auto Farm Coins (TP + Collect)",
    CurrentValue = false,
    Flag = "AutoFarmCoinsToggle",
    Callback = function(Value)
        getgenv().AutoFarmCoins = Value
        Rayfield:Notify({
            Title = "Auto Farm Coins";
            Content = Value and "B·∫≠t!" or "T·∫Øt!";
            Duration = 2
        })
    end
})

-- Info Label
Tab:CreateLabel("üí° Farm EXP b·∫±ng GodMode + s·ªëng s√≥t round")

-- Button Rejoin current mode
Tab:CreateButton({
    Name = "Rejoin Server (Hi·ªán T·∫°i)",
    Callback = function()
        game:GetService("TeleportService"):Teleport(PlaceId, player)
    end
})

-- Button Go to Classic (n·∫øu mu·ªën)
Tab:CreateButton({
    Name = "Go to Classic Mode (142823291)",
    Callback = function()
        game:GetService("TeleportService"):Teleport(142823291, player)
    end
})

Rayfield:Notify({
    Title = "‚úÖ Loaded!";
    Content = "S·ª≠ d·ª•ng Toggle ƒë·ªÉ b·∫≠t/t·∫Øt! Ho·∫°t ƒë·ªông m·ªçi mode MM2!";
    Duration = 5;
    Image = 4483362458
})

-- Auto apply GodMode n·∫øu b·∫≠t
player.CharacterAdded:Connect(function()
    wait(1)
    if getgenv().GodMode then applyGodMode(player.Character) end
end)
