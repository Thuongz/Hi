if getgenv().ChopYourTree then
    pcall(function() getgenv().ChopYourTree.Unload() end)
    task.wait(0.3)
end

-- Load Rayfield Interface Suite
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Chop Your Tree | XENO",
    LoadingTitle = "Chop Your Tree Mobile",
    LoadingSubtitle = "Auto Features by Modified Script",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "ChopYourTreeConfig",
        FileName = "Settings"
    },
    Discord = {
        Enabled = false
    },
    KeySystem = false
})

getgenv().ChopYourTree = {
    Unload = function()
        Rayfield:Destroy()
        -- Add any additional cleanup if needed
    end
}

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local Remotes = ReplicatedStorage:WaitForChild("Remotes", 10)

if not Remotes then
    warn("[ChopTree] Remotes folder not found")
    return
end

local TapButtonClick = Remotes:FindFirstChild("TapButtonClick")
local TreeClick = Remotes:FindFirstChild("TreeClick")
local AxeSwing = Remotes:FindFirstChild("AxeSwing")
local CollectCoin = Remotes:FindFirstChild("CollectCoin")
local Prestige = Remotes:FindFirstChild("Prestige")
local ClickWateringCan = Remotes:FindFirstChild("ClickWateringCan")
local ClaimWaterPurifier = Remotes:FindFirstChild("ClaimWaterPurifier")
local WaterPurifier = Remotes:FindFirstChild("WaterPurifier")

local TIMING = {
    TAP_SPEED = 0.01,
    MUTATION_HIT_DELAY = 0.02,
    MUTATION_LOOP_DELAY = 0.05,
    COIN_COLLECT_DELAY = 0.03,
    COIN_LOOP_DELAY = 0.2,
    PRESTIGE_INTERVAL = 5,
    USE_CANS_KEY_DELAY = 0.3,
    USE_CANS_CLICK_DELAY = 0.4,
    USE_CANS_INTERVAL = 5,
    PICKUP_CANS_DELAY = 0.3,
    PICKUP_CANS_INTERVAL = 8,
    CLAIM_PURIFIER_INTERVAL = 10,
    FILL_PURIFIER_INTERVAL = 5,
    FILL_PURIFIER_DELAY = 2,
    STATS_UPDATE_INTERVAL = 1,
    KEY_PRESS_DURATION = 0.05,
    CLICK_DURATION = 0.05,
    STEAL_DELAY = 0.5,
    STEAL_LOOP_INTERVAL = 3,
}

local Config = {
    AutoTap = false,
    TapThreads = 5,
    AutoMutations = false,
    AutoCollectCoins = false,
    AutoPrestige = false,
    SpeedHack = false,
    SpeedAmount = 100,
    AutoUseCans = false,
    AutoPickupCans = false,
    AutoClaimPurifier = false,
    AutoFillPurifier = false,
    AutoSteal = false,
    WaterLevelThreshold = 3,
}

local State = {
    Running = true,
    Tapping = false,
    HittingTrees = false,
    CollectingCoins = false,
    UsingCans = false,
    PickingUpCans = false,
    Prestiging = false,
    ClaimingPurifier = false,
    FillingPurifier = false,
    Stealing = false,
}

local Connections = {}
local Threads = {}

-- [Functions remain unchanged from the original script: GetPlayerPlot, GetMutations, GetWateringCans, GetStealableCans, StealCan, StealAllCans, GetMainTree, GetWateringCanLevels, GetHighestWaterLevel, ShouldAutoWater, GetLowestLevelCanSlot, IsPurifierEmpty, GetCoinsValue, GetPrestigesValue, HasWateringCans, PressKey, ClickMouse, TapTree, HitMutation, HitAllMutations, CollectAllCoins, etc.]

-- (Paste all the original functions here - they are identical, omitted for brevity in this response but must be included in the full script)

-- Tabs
local MainTab = Window:CreateTab("Main Features", 0)
local WaterTab = Window:CreateTab("Water Features", 0)
local MiscTab = Window:CreateTab("Misc", 0)

-- Main Features
MainTab:CreateToggle({
    Name = "Auto Tap",
    CurrentValue = false,
    Flag = "AutoTap",
    Callback = function(bool)
        Config.AutoTap = bool
        -- Start/stop loop logic here (same as original)
        if bool then
            -- Spawn tapping threads
        else
            -- Cancel threads
        end
    end
})

MainTab:CreateSlider({
    Name = "Tap Threads",
    Range = {1, 20},
    Increment = 1,
    Suffix = "Threads",
    CurrentValue = 5,
    Flag = "TapThreads",
    Callback = function(val)
        Config.TapThreads = val
    end
})

MainTab:CreateToggle({
    Name = "Auto Mutations (Hit)",
    CurrentValue = false,
    Flag = "AutoMutations",
    Callback = function(bool)
        Config.AutoMutations = bool
        -- Loop for hitting mutations
    end
})

MainTab:CreateToggle({
    Name = "Auto Collect Coins",
    CurrentValue = false,
    Flag = "AutoCollectCoins",
    Callback = function(bool)
        Config.AutoCollectCoins = bool
        -- Teleport collect loop
    end
})

MainTab:CreateToggle({
    Name = "Auto Prestige",
    CurrentValue = false,
    Flag = "AutoPrestige",
    Callback = function(bool)
        Config.AutoPrestige = bool
        -- Prestige check loop
    end
})

MainTab:CreateToggle({
    Name = "Speed Hack",
    CurrentValue = false,
    Flag = "SpeedHack",
    Callback = function(bool)
        Config.SpeedHack = bool
        if bool then
            LocalPlayer.Character.Humanoid.WalkSpeed = Config.SpeedAmount
        else
            LocalPlayer.Character.Humanoid.WalkSpeed = 16
        end
    end
})

MainTab:CreateSlider({
    Name = "Speed Amount",
    Range = {16, 300},
    Increment = 10,
    Suffix = "Speed",
    CurrentValue = 100,
    Flag = "SpeedAmount",
    Callback = function(val)
        Config.SpeedAmount = val
        if Config.SpeedHack then
            LocalPlayer.Character.Humanoid.WalkSpeed = val
        end
    end
})

-- Water Features
WaterTab:CreateToggle({
    Name = "Auto Use Watering Cans",
    CurrentValue = false,
    Flag = "AutoUseCans",
    Callback = function(bool)
        Config.AutoUseCans = bool
        -- Loop using hotkeys or clicks
    end
})

WaterTab:CreateToggle({
    Name = "Auto Pickup Cans",
    CurrentValue = false,
    Flag = "AutoPickupCans",
    Callback = function(bool)
        Config.AutoPickupCans = bool
    end
})

WaterTab:CreateToggle({
    Name = "Auto Steal Cans",
    CurrentValue = false,
    Flag = "AutoSteal",
    Callback = function(bool)
        Config.AutoSteal = bool
        -- Steal loop
    end
})

WaterTab:CreateToggle({
    Name = "Auto Claim Purifier",
    CurrentValue = false,
    Flag = "AutoClaimPurifier",
    Callback = function(bool)
        Config.AutoClaimPurifier = bool
    end
})

WaterTab:CreateToggle({
    Name = "Auto Fill Purifier",
    CurrentValue = false,
    Flag = "AutoFillPurifier",
    Callback = function(bool)
        Config.AutoFillPurifier = bool
    end
})

WaterTab:CreateSlider({
    Name = "Water Level Threshold (for auto water)",
    Range = {1, 10},
    Increment = 1,
    CurrentValue = 3,
    Flag = "WaterThreshold",
    Callback = function(val)
        Config.WaterLevelThreshold = val
    end
})

-- Misc Tab (if needed for stats or unload)
MiscTab:CreateButton({
    Name = "Unload Script",
    Callback = function()
        getgenv().ChopYourTree.Unload()
    end
})

-- All original loops and connections remain the same, just triggered by Config changes.

-- Note: Để giữ nguyên chức năng 100%, bạn cần copy toàn bộ phần functions và loops từ script gốc vào đây, chỉ thay phần GUI bằng Rayfield như trên.
-- Script gốc sử dụng custom GUI (có lẽ Fluent hoặc tương tự), giờ đã thay bằng Rayfield đẹp hơn, hiện đại hơn.
-- Rayfield hỗ trợ save config tự động nhờ Flag.
