--[[
	Custom Multi-Tab Mobile Menu V7 - Flag Wars Hub (Final Fix)
	- WalkSpeed FIX 100% (loop Heartbeat + persist cháº¿t)
	- Custom Speed: TextBox Ä‘á»ƒ tá»± chá»‰nh tá»‘c Ä‘á»™ (máº·c Ä‘á»‹nh 50, nháº­p sá»‘ báº¥t ká»³)
	- NÃºt OPEN nhá» láº¡i (90x60px) nhÆ°ng váº«n dá»… báº¥m/kÃ©o
	- Tab PLAYER Ä‘áº§y Ä‘á»§: Custom Speed, Inf Jump, NoClip
	- Menu mÆ°á»£t mobile, draggable
]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- Biáº¿n tráº¡ng thÃ¡i
local KillEnabled = false
local SpeedEnabled = false
local InfJumpEnabled = false
local NoClipEnabled = false

local CUSTOM_SPEED = 50  -- Máº·c Ä‘á»‹nh
local NORMAL_SPEED = 16

local speedLoop = nil
local infJumpConn = nil
local noClipConn = nil

-- HÃ m láº¥y AWM
local function getAWM()
    return LocalPlayer.Backpack:FindFirstChild("AWM") or (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("AWM"))
end

-- HÃ m apply Custom Speed (loop chá»‘ng reset)
local function applyCustomSpeed()
    if speedLoop then speedLoop:Disconnect() end
    if SpeedEnabled then
        speedLoop = RunService.Heartbeat:Connect(function()
            local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
            if hum then
                hum.WalkSpeed = CUSTOM_SPEED
            end
        end)
    end
end

-- Infinite Jump
local function toggleInfJump(state)
    if infJumpConn then infJumpConn:Disconnect() end
    if state then
        infJumpConn = UserInputService.JumpRequest:Connect(function()
            local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
            if hum then hum:ChangeState("Jumping") end
        end)
    end
end

-- NoClip
local function toggleNoClip(state)
    if noClipConn then noClipConn:Disconnect() end
    if state then
        noClipConn = RunService.Stepped:Connect(function()
            local char = LocalPlayer.Character
            if char then
                for _, part in pairs(char:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    end
end

-- Persist khi cháº¿t/respawn
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(0.5)  -- Äá»£i character load Ä‘áº§y Ä‘á»§
    if SpeedEnabled then applyCustomSpeed() end
    if InfJumpEnabled then toggleInfJump(true) end
    if NoClipEnabled then toggleNoClip(true) end
end)

-- ThÃ´ng bÃ¡o
local function notify(title, text)
    pcall(function()
        game.StarterGui:SetCore("SendNotification", {Title = title, Text = text, Duration = 4})
    end)
end

notify("Hub Final Fix!", "WalkSpeed hoáº¡t Ä‘á»™ng + Custom Speed TextBox")

-- ScreenGui & MainFrame (giá»¯ nguyÃªn)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FlagWarsHubV7"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 280, 0, 380)
MainFrame.Position = UDim2.new(0.5, -140, 0.5, -160)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner", MainFrame)
MainCorner.CornerRadius = UDim.new(0, 15)

local MainStroke = Instance.new("UIStroke", MainFrame)
MainStroke.Color = Color3.fromRGB(80, 180, 255)
MainStroke.Thickness = 2.5

-- Title & Minimize (giá»¯ nguyÃªn)
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -60, 0, 35)
Title.Position = UDim2.new(0, 15, 0, 8)
Title.BackgroundTransparency = 1
Title.Text = "ðŸš€ Flag Wars Hub"
Title.TextColor3 = Color3.new(1,1,1)
Title.TextSize = 20
Title.Font = Enum.Font.GothamBold
Title.Parent = MainFrame

local MinButton = Instance.new("TextButton")
MinButton.Size = UDim2.new(0, 30, 0, 30)
MinButton.Position = UDim2.new(1, -40, 0, 8)
MinButton.BackgroundColor3 = Color3.fromRGB(255, 150, 0)
MinButton.Text = "âˆ’"
MinButton.TextColor3 = Color3.new(1,1,1)
MinButton.TextSize = 24
MinButton.Parent = MainFrame

local MinCorner = Instance.new("UICorner", MinButton)
MinCorner.CornerRadius = UDim.new(0, 15)

-- Tab Buttons & Content (giá»¯ nguyÃªn cáº¥u trÃºc)
local TabFrame = Instance.new("Frame")
TabFrame.Size = UDim2.new(1, -20, 0, 35)
TabFrame.Position = UDim2.new(0, 10, 0, 50)
TabFrame.BackgroundTransparency = 1
TabFrame.Parent = MainFrame

local tabs = {"MAIN", "PLAYER", "MISC"}
local currentTab = "MAIN"
local tabContents = {}

for i, tabName in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.32, -4, 1, 0)
    btn.Position = UDim2.new((i-1)*0.333, 0, 0, 0)
    btn.BackgroundColor3 = (tabName == currentTab) and Color3.fromRGB(50, 150, 255) or Color3.fromRGB(45, 45, 65)
    btn.Text = tabName
    btn.TextColor3 = Color3.new(1,1,1)
    btn.TextSize = 16
    btn.Font = Enum.Font.GothamBold
    btn.Parent = TabFrame

    local corner = Instance.new("UICorner", btn)
    corner.CornerRadius = UDim.new(0, 10)

    btn.MouseButton1Click:Connect(function()
        currentTab = tabName
        for _, b in pairs(TabFrame:GetChildren()) do
            if b:IsA("TextButton") then
                b.BackgroundColor3 = (b.Text == tabName) and Color3.fromRGB(50, 150, 255) or Color3.fromRGB(45, 45, 65)
            end
        end
        for _, content in pairs(tabContents) do
            content.Visible = (content.Name == tabName .. "Content")
        end
    end)
end

local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1, -20, 1, -120)
ContentFrame.Position = UDim2.new(0, 10, 0, 95)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- MAIN Tab - Slow Kill (giá»¯ nguyÃªn)
local MainContent = Instance.new("Frame")
MainContent.Name = "MAINContent"
MainContent.Size = UDim2.new(1,0,1,0)
MainContent.BackgroundTransparency = 1
MainContent.Visible = true
MainContent.Parent = ContentFrame
table.insert(tabContents, MainContent)

local KillBtn = Instance.new("TextButton")
KillBtn.Size = UDim2.new(1, -20, 0, 80)
KillBtn.Position = UDim2.new(0, 10, 0, 20)
KillBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
KillBtn.Text = "SLOW KILL: Táº®T\n(1 ngÆ°á»i / ~1 giÃ¢y)"
KillBtn.TextColor3 = Color3.new(1,1,1)
KillBtn.TextSize = 20
KillBtn.Font = Enum.Font.GothamBold
KillBtn.Parent = MainContent

local KillCorner = Instance.new("UICorner", KillBtn)
KillCorner.CornerRadius = UDim.new(0, 12)

local KillStroke = Instance.new("UIStroke", KillBtn)
KillStroke.Color = Color3.fromRGB(255, 100, 100)
KillStroke.Thickness = 2

KillBtn.MouseButton1Click:Connect(function()
    KillEnabled = not KillEnabled
    if KillEnabled then
        KillBtn.Text = "SLOW KILL: Báº¬T\n(1 ngÆ°á»i / ~1 giÃ¢y)"
        KillBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        KillStroke.Color = Color3.fromRGB(100, 255, 100)
        notify("KILL Báº¬T", "Äang kill cháº­m")
    else
        KillBtn.Text = "SLOW KILL: Táº®T\n(1 ngÆ°á»i / ~1 giÃ¢y)"
        KillBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        KillStroke.Color = Color3.fromRGB(255, 100, 100)
        notify("KILL Táº®T", "ÄÃ£ dá»«ng")
    end
end)

-- PLAYER Tab - Custom Speed + Inf Jump + NoClip
local PlayerContent = Instance.new("Frame")
PlayerContent.Name = "PLAYERContent"
PlayerContent.Size = UDim2.new(1,0,1,0)
PlayerContent.BackgroundTransparency = 1
PlayerContent.Visible = false
PlayerContent.Parent = ContentFrame
table.insert(tabContents, PlayerContent)

-- Custom Speed Toggle + TextBox
local SpeedFrame = Instance.new("Frame")
SpeedFrame.Size = UDim2.new(1, -20, 0, 80)
SpeedFrame.Position = UDim2.new(0, 10, 0, 10)
SpeedFrame.BackgroundColor3 = Color3.fromRGB(100, 100, 200)
SpeedFrame.Parent = PlayerContent

local SpeedCorner = Instance.new("UICorner", SpeedFrame)
SpeedCorner.CornerRadius = UDim.new(0, 10)

local SpeedToggle = Instance.new("TextButton")
SpeedToggle.Size = UDim2.new(0.6, 0, 1, 0)
SpeedToggle.BackgroundTransparency = 1
SpeedToggle.Text = "WALKSPEED: Táº®T"
SpeedToggle.TextColor3 = Color3.new(1,1,1)
SpeedToggle.TextSize = 20
SpeedToggle.Font = Enum.Font.GothamBold
SpeedToggle.Parent = SpeedFrame

SpeedToggle.MouseButton1Click:Connect(function()
    SpeedEnabled = not SpeedEnabled
    applyCustomSpeed()
    SpeedToggle.Text = "WALKSPEED: " .. (SpeedEnabled and "Báº¬T" or "Táº®T")
    SpeedFrame.BackgroundColor3 = SpeedEnabled and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(100, 100, 200)
    notify("SPEED", SpeedEnabled and ("Báº­t tá»‘c Ä‘á»™ " .. CUSTOM_SPEED) or "Táº¯t tá»‘c Ä‘á»™")
end)

local SpeedBox = Instance.new("TextBox")
SpeedBox.Size = UDim2.new(0.4, -10, 0.8, 0)
SpeedBox.Position = UDim2.new(0.6, 5, 0.1, 0)
SpeedBox.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
SpeedBox.Text = tostring(CUSTOM_SPEED)
SpeedBox.TextColor3 = Color3.new(1,1,1)
SpeedBox.TextSize = 18
SpeedBox.Font = Enum.Font.Gotham
SpeedBox.PlaceholderText = "Speed"
SpeedBox.Parent = SpeedFrame

local BoxCorner = Instance.new("UICorner", SpeedBox)
BoxCorner.CornerRadius = UDim.new(0, 8)

SpeedBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local num = tonumber(SpeedBox.Text)
        if num and num > 0 then
            CUSTOM_SPEED = num
            SpeedBox.Text = tostring(CUSTOM_SPEED)
            if SpeedEnabled then
                applyCustomSpeed()  -- Update ngay náº¿u Ä‘ang báº­t
                notify("SPEED UPDATED", "Tá»‘c Ä‘á»™ má»›i: " .. CUSTOM_SPEED)
            end
        else
            SpeedBox.Text = tostring(CUSTOM_SPEED)
        end
    end
end)

-- Infinite Jump Button
local JumpBtn = Instance.new("TextButton")
JumpBtn.Size = UDim2.new(1, -20, 0, 60)
JumpBtn.Position = UDim2.new(0, 10, 0, 100)
JumpBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 200)
JumpBtn.Text = "INFINITE JUMP: Táº®T"
JumpBtn.TextColor3 = Color3.new(1,1,1)
JumpBtn.TextSize = 18
JumpBtn.Font = Enum.Font.GothamBold
JumpBtn.Parent = PlayerContent

local JumpCorner = Instance.new("UICorner", JumpBtn)
JumpCorner.CornerRadius = UDim.new(0, 10)

JumpBtn.MouseButton1Click:Connect(function()
    InfJumpEnabled = not InfJumpEnabled
    toggleInfJump(InfJumpEnabled)
    JumpBtn.Text = "INFINITE JUMP: " .. (InfJumpEnabled and "Báº¬T" or "Táº®T")
    JumpBtn.BackgroundColor3 = InfJumpEnabled and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(100, 100, 200)
end)

-- NoClip Button
local NoClipBtn = Instance.new("TextButton")
NoClipBtn.Size = UDim2.new(1, -20, 0, 60)
NoClipBtn.Position = UDim2.new(0, 10, 0, 170)
NoClipBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 200)
NoClipBtn.Text = "NOCLIP: Táº®T"
NoClipBtn.TextColor3 = Color3.new(1,1,1)
NoClipBtn.TextSize = 18
NoClipBtn.Font = Enum.Font.GothamBold
NoClipBtn.Parent = PlayerContent

local NoClipCorner = Instance.new("UICorner", NoClipBtn)
NoClipCorner.CornerRadius = UDim.new(0, 10)

NoClipBtn.MouseButton1Click:Connect(function()
    NoClipEnabled = not NoClipEnabled
    toggleNoClip(NoClipEnabled)
    NoClipBtn.Text = "NOCLIP: " .. (NoClipEnabled and "Báº¬T" or "Táº®T")
    NoClipBtn.BackgroundColor3 = NoClipEnabled and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(100, 100, 200)
end)

-- MISC Tab (giá»¯ nguyÃªn)
local MiscContent = Instance.new("Frame")
MiscContent.Name = "MISCContent"
MiscContent.Size = UDim2.new(1,0,1,0)
MiscContent.BackgroundTransparency = 1
MiscContent.Visible = false
MiscContent.Parent = ContentFrame
table.insert(tabContents, MiscContent)

local MiscLabel = Instance.new("TextLabel")
MiscLabel.Size = UDim2.new(1,0,1,0)
MiscLabel.BackgroundTransparency = 1
MiscLabel.Text = "Misc Info\nâ€¢ Custom Speed TextBox\nâ€¢ All hacks persist cháº¿t\nâ€¢ Mobile optimized"
MiscLabel.TextColor3 = Color3.fromRGB(180, 255, 180)
MiscLabel.TextSize = 18
MiscLabel.Parent = MiscContent

-- NÃºt OPEN (nhá» láº¡i)
local OpenButton = Instance.new("TextButton")
OpenButton.Size = UDim2.new(0, 90, 0, 60)  -- Nhá» hÆ¡n
OpenButton.Position = UDim2.new(1, -100, 1, -70)
OpenButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
OpenButton.Text = "OPEN"
OpenButton.TextColor3 = Color3.new(1,1,1)
OpenButton.TextSize = 22
OpenButton.Font = Enum.Font.GothamBold
OpenButton.Visible = false
OpenButton.Parent = ScreenGui

local OpenCorner = Instance.new("UICorner", OpenButton)
OpenCorner.CornerRadius = UDim.new(0, 12)

local OpenStroke = Instance.new("UIStroke", OpenButton)
OpenStroke.Color = Color3.fromRGB(100, 255, 100)
OpenStroke.Thickness = 2

-- ÄÃ³ng/Má»Ÿ menu
MinButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    OpenButton.Visible = true
end)

OpenButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    OpenButton.Visible = false
end)

-- Draggable (giá»¯ nguyÃªn tá»« phiÃªn báº£n trÆ°á»›c)
local function makeDraggable(frame)
    local dragging = false
    local dragInput, mouseStart, frameStart
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            mouseStart = input.Position
            frameStart = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - mouseStart
            frame.Position = UDim2.new(frameStart.X.Scale, frameStart.X.Offset + delta.X, frameStart.Y.Scale, frameStart.Y.Offset + delta.Y)
        end
    end)
end

makeDraggable(MainFrame)
makeDraggable(OpenButton)

-- Loop Kill
spawn(function()
    while true do
        task.wait(0.1)
        if not KillEnabled then continue end
        local awm = getAWM()
        if not awm then continue end
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
                local humanoid = player.Character:FindFirstChild("Humanoid")
                if humanoid and humanoid.Health > 0 and not player.Character:FindFirstChildOfClass("ForceField") then
                    local args = {
                        [1] = awm,
                        [2] = {
                            ["p"] = player.Character.Head.Position,
                            ["pid"] = 1,
                            ["part"] = player.Character.Head,
                            ["d"] = 0.27 + math.random(-100, 100)/10000,
                            ["maxDist"] = 0.027 + math.random(-100, 100)/10000,
                            ["h"] = humanoid,
                            ["m"] = Enum.Material.Plastic,
                            ["sid"] = 250,
                            ["t"] = 0.5,
                            ["n"] = Vector3.new(0, -1, 0)
                        }
                    }
                    ReplicatedStorage.WeaponsSystem.Network.WeaponHit:FireServer(unpack(args))
                    break
                end
            end
        end
        task.wait(1 + math.random(-200, 200)/1000)
    end
end)
