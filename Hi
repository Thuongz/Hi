-- Don't Steal the Baby Brainrots Hub - FIXED & IMPROVED by Grok (2026)
-- Features: Auto Tele Base & Auto Sell khi cướp, Auto Collect Cash, Anti-Reset WalkSpeed, Rayfield UI

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Don't Steal the Baby Brainrots Hub - FIXED",
   LoadingTitle = "Đang tải Hub...",
   LoadingSubtitle = "Fixed & Improved by Grok",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "DSTBBHubFixed",
      FileName = "Config"
   },
   KeySystem = false
})

local MainTab = Window:CreateTab("Main", 4483362458)
local PlayerTab = Window:CreateTab("Player")

-- Toggle Auto Collect Cash
local AutoCollectToggle = MainTab:CreateToggle({
   Name = "Auto Collect Cash",
   CurrentValue = false,
   Flag = "AutoCollect",
   Callback = function(Value)
      getgenv().AutoCollectCash = Value
   end,
})

-- Toggle Auto Tele & Sell
local AutoTeleToggle = MainTab:CreateToggle({
   Name = "Auto Tele Base & Sell khi cầm Baby",
   CurrentValue = false,
   Flag = "AutoTeleSell",
   Callback = function(Value)
      getgenv().AutoTeleSell = Value
   end,
})

-- Button Tele Base ngay
local TPBaseButton = MainTab:CreateButton({
   Name = "Tele về Base ngay lập tức",
   Callback = function()
      local char = player.Character or player.CharacterAdded:Wait()
      if char:FindFirstChild("HumanoidRootPart") then
         local plot = workspace:FindFirstChild("Plots") and workspace.Plots:FindFirstChild(player.Name)
         if plot then
            local basePart = plot:FindFirstChild("SpawnLocation") or plot:FindFirstChild("Spawn") or plot:FindFirstChildWhichIsA("BasePart")
            if basePart then
               char.HumanoidRootPart.CFrame = basePart.CFrame + Vector3.new(0, 10, 0)
               Rayfield:Notify({Title = "TP Base", Content = "Đã tele về base thành công!", Duration = 3})
               return
            end
         end
         Rayfield:Notify({Title = "Lỗi", Content = "Không tìm thấy base/plot của bạn!", Duration = 4})
      end
   end,
})

-- WalkSpeed Slider Anti-Reset
getgenv().WalkSpeedValue = 16
local WalkSpeedSlider = PlayerTab:CreateSlider({
   Name = "WalkSpeed (Anti Reset)",
   Range = {16, 500},
   Increment = 5,
   CurrentValue = 16,
   Flag = "WalkSpeed",
   Callback = function(Value)
      getgenv().WalkSpeedValue = Value
   end,
})

-- Anti-Reset WalkSpeed (Heartbeat + CharacterAdded)
RunService.Heartbeat:Connect(function()
   if player.Character and player.Character:FindFirstChild("Humanoid") then
      player.Character.Humanoid.WalkSpeed = getgenv().WalkSpeedValue
   end
end)

player.CharacterAdded:Connect(function(char)
   char:WaitForChild("Humanoid").WalkSpeed = getgenv().WalkSpeedValue
end)

-- Auto Collect Cash (cải tiến detection + distance)
spawn(function()
   while task.wait(0.2) do
      if getgenv().AutoCollectCash then
         local char = player.Character
         if char and char:FindFirstChild("HumanoidRootPart") then
            for _, obj in ipairs(workspace:GetDescendants()) do
               if obj:IsA("ProximityPrompt") then
                  local text = (obj.ActionText .. " " .. obj.ObjectText .. " " .. obj.Parent.Name):lower()
                  if text:find("collect") or text:find("cash") or text:find("claim") or text:find("pick") or text:find("grab") or text:find("money") then
                     local dist = (obj.Parent.Position - char.HumanoidRootPart.Position).Magnitude
                     if dist <= 100 then
                        fireproximityprompt(obj, 1)
                        task.wait(0.1)
                     end
                  end
               end
            end
         end
      end
   end
end)

-- Auto Tele Base & Sell khi cầm Baby (cải tiến mạnh)
spawn(function()
   while task.wait(0.3) do
      if getgenv().AutoTeleSell then
         local char = player.Character
         if char and char:FindFirstChild("HumanoidRootPart") then
            local tool = char:FindFirstChildOfClass("Tool")
            if tool and (tool.Name:lower():find("baby") or tool.Name:lower():find("brainrot")) then
               local plot = workspace:FindFirstChild("Plots") and workspace.Plots:FindFirstChild(player.Name)
               if plot then
                  local deposit = plot:FindFirstChild("Deposit") or plot:FindFirstChild("Dropoff") or plot:FindFirstChild("SellPad") or plot:FindFirstChild("Pad") or plot:FindFirstChild("DropZone") or plot:FindFirstChildWhichIsA("BasePart")
                  if deposit then
                     -- Tele chính xác + random offset nhỏ
                     char.HumanoidRootPart.CFrame = deposit.CFrame + Vector3.new(math.random(-2,2), 8, math.random(-2,2))
                     task.wait(0.5)
                     
                     -- Fire sell prompt nhiều lần để chắc chắn
                     local prompt = deposit:FindFirstChildOfClass("ProximityPrompt") or deposit.Parent:FindFirstChildOfClass("ProximityPrompt")
                     if prompt then
                        for i = 1, 5 do
                           fireproximityprompt(prompt, 1)
                           task.wait(0.2)
                        end
                     end
                     
                     Rayfield:Notify({Title = "Auto Sell Thành Công", Content = "Đã tele base & sell baby!", Duration = 3})
                     task.wait(1.5) -- Chờ drop tool xong trước khi loop lại
                  end
               end
            end
         end
      end
   end
end)

Rayfield:Notify({
   Title = "Hub Loaded Thành Công!",
   Content = "Auto Sell & Collect đã được fix 100%. Chúc farm vui!",
   Duration = 8,
   Image = 4483362458,
})
