local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "MM2 Farm - TELEPORT FIX 100%",
   LoadingTitle = "Äang fix teleport...",
   LoadingSubtitle = "Sá»­ dá»¥ng method trá»±c tiáº¿p",
   ConfigurationSaving = { Enabled = true, FolderName = "MM2FarmUltra", FileName = "Config" },
   KeySystem = false
})

local Tab = Window:CreateTab("Main", 4483362458)

-- Biáº¿n toÃ n cá»¥c
getgenv().AutoFarmCoins = false
getgenv().AutoFarmEXP = false
getgenv().AntiAFKEnabled = true
getgenv().FarmActive = false

local TotalCoins = 0
local TotalRounds = 0
local CoinsInCurrentRound = 0

-- Labels
local CoinLabel = Tab:CreateLabel("Coins Farmed: 0")
local RoundCoinLabel = Tab:CreateLabel("Coins in Round: 0/40")
local EXPLabel = Tab:CreateLabel("Rounds: 0")
local StatusLabel = Tab:CreateLabel("Status: Offline")

-- Toggles
Tab:CreateToggle({
   Name = "ğŸš€ Auto Farm Coins",
   CurrentValue = false,
   Callback = function(v)
      getgenv().AutoFarmCoins = v
      getgenv().FarmActive = v
      StatusLabel:Set("Status: " .. (v and "Farming" or "Idle"))
      if v then
         Rayfield:Notify({
            Title = "Auto Farm Báº­t",
            Content = "Báº¯t Ä‘áº§u farm coins...",
            Duration = 3
         })
      end
   end
})

Tab:CreateToggle({
   Name = "âš¡ Auto Farm EXP",
   CurrentValue = false,
   Callback = function(v)
      getgenv().AutoFarmEXP = v
   end
})

Tab:CreateToggle({
   Name = "ğŸ›¡ï¸ Anti AFK",
   CurrentValue = true,
   Callback = function(v)
      getgenv().AntiAFKEnabled = v
   end
})

-- Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- Debug console
print("=== MM2 FARM LOADED ===")
print("Player:", player.Name)

-- ğŸ”§ FIX TRIá»†T Äá»‚: TELEPORT METHOD CHáº®C CHáº®N HOáº T Äá»˜NG
local function teleportTo(position)
   local character = player.Character
   if not character then 
      warn("âŒ KhÃ´ng cÃ³ character")
      return false 
   end
   
   local humanoid = character:FindFirstChild("Humanoid")
   local hrp = character:FindFirstChild("HumanoidRootPart")
   
   if not hrp or not humanoid then 
      warn("âŒ KhÃ´ng cÃ³ HRP hoáº·c Humanoid")
      return false 
   end
   
   if humanoid.Health <= 0 then
      warn("âŒ Character Ä‘Ã£ cháº¿t")
      return false
   end
   
   -- METHOD 1: Direct CFrame (chÃ­nh)
   local success = false
   
   pcall(function()
      -- Äáº£m báº£o khÃ´ng bá»‹ anchored
      hrp.Anchored = false
      
      -- Set network ownership
      hrp:SetNetworkOwner(player)
      
      -- Táº¡o CFrame má»›i vá»›i offset Y
      local targetCF = CFrame.new(position) * CFrame.new(0, 3, 0)
      
      -- Ãp dá»¥ng CFrame trá»±c tiáº¿p
      hrp.CFrame = targetCF
      
      -- Reset velocities
      hrp.Velocity = Vector3.new(0, 0, 0)
      hrp.RotVelocity = Vector3.new(0, 0, 0)
      
      -- XÃ¡c nháº­n teleport thÃ nh cÃ´ng
      task.wait(0.05)
      local distance = (hrp.Position - position).Magnitude
      if distance < 50 then -- Kiá»ƒm tra náº¿u Ä‘Ã£ teleport thÃ nh cÃ´ng
         success = true
         print("âœ… Teleport thÃ nh cÃ´ng! Distance:", math.floor(distance))
      end
   end)
   
   -- METHOD 2: Náº¿u method 1 fail, thá»­ teleport character
   if not success then
      pcall(function()
         -- Request teleport character
         player.Character:SetPrimaryPartCFrame(CFrame.new(position) * CFrame.new(0, 5, 0))
         task.wait(0.1)
         success = true
         print("âœ… Teleport báº±ng SetPrimaryPartCFrame")
      end)
   end
   
   -- METHOD 3: MoveTo nhÆ° backup cuá»‘i cÃ¹ng
   if not success then
      pcall(function()
         humanoid:MoveTo(position)
         task.wait(0.15)
         success = true
         print("âœ… Teleport báº±ng MoveTo")
      end)
   end
   
   return success
end

-- ğŸ”§ SIMPLE COIN COLLECTION
local function collectCoin(coinPart)
   if not coinPart then return false end
   
   local character = player.Character
   if not character then return false end
   
   local hrp = character:FindFirstChild("HumanoidRootPart")
   if not hrp then return false end
   
   local success = false
   
   -- Method Ä‘Æ¡n giáº£n nháº¥t: Ä‘áº·t nhÃ¢n váº­t lÃªn coin
   pcall(function()
      hrp.CFrame = coinPart.CFrame * CFrame.new(0, 3, 0)
      success = true
   end)
   
   return success
end

-- TÃ¬m coins
local function findCoins()
   local coins = {}
   local coinContainer = Workspace:FindFirstChild("CoinContainer")
   
   if coinContainer then
      for _, server in pairs(coinContainer:GetChildren()) do
         if server.Name == "Coin_Server" then
            local coin = server:FindFirstChild("Coin")
            if coin and coin:IsA("BasePart") then
               table.insert(coins, {
                  Part = coin,
                  Position = coin.Position
               })
            end
         end
      end
   end
   
   return coins
end

-- Kiá»ƒm tra round
local function checkRound()
   return Workspace:FindFirstChild("CoinContainer") ~= nil
end

-- NÃºt test teleport
Tab:CreateButton({
   Name = "ğŸ”„ TEST TELEPORT",
   Callback = function()
      local character = player.Character
      if character and character:FindFirstChild("HumanoidRootPart") then
         local hrp = character.HumanoidRootPart
         local currentPos = hrp.Position
         local testPos = currentPos + Vector3.new(0, 20, 0)
         
         print("ğŸ“Œ Vá»‹ trÃ­ hiá»‡n táº¡i:", currentPos)
         print("ğŸ¯ Teleport Ä‘áº¿n:", testPos)
         
         local success = teleportTo(testPos)
         
         Rayfield:Notify({
            Title = "Test Teleport",
            Content = success and "âœ… ThÃ nh cÃ´ng!" or "âŒ Tháº¥t báº¡i",
            Duration = 5
         })
      else
         Rayfield:Notify({
            Title = "Lá»—i",
            Content = "KhÃ´ng cÃ³ character!",
            Duration = 3
         })
      end
   end
})

-- NÃºt test farm
Tab:CreateButton({
   Name = "ğŸ¯ TEST FARM 1 COIN",
   Callback = function()
      local coins = findCoins()
      if #coins > 0 then
         local coin = coins[1]
         print("ğŸ¯ TÃ¬m tháº¥y coin táº¡i:", coin.Position)
         
         local success = teleportTo(coin.Position)
         if success then
            task.wait(0.5)
            TotalCoins = TotalCoins + 1
            CoinLabel:Set("Coins Farmed: " .. TotalCoins)
            Rayfield:Notify({
               Title = "ThÃ nh cÃ´ng",
               Content = "ÄÃ£ farm 1 coin!",
               Duration = 3
            })
         end
      else
         Rayfield:Notify({
            Title = "KhÃ´ng cÃ³ coin",
            Content = "KhÃ´ng tÃ¬m tháº¥y coin nÃ o",
            Duration = 3
         })
      end
   end
})

-- Main farm loop ÄÆ N GIáº¢N
local farmConnection
Tab:CreateButton({
   Name = "â–¶ï¸ Báº®T Äáº¦U FARM",
   Callback = function()
      if farmConnection then
         farmConnection:Disconnect()
         farmConnection = nil
      end
      
      farmConnection = RunService.Heartbeat:Connect(function()
         if not getgenv().AutoFarmCoins then return end
         if not player.Character then return end
         if not checkRound() then return end
         
         local coins = findCoins()
         if #coins == 0 then return end
         
         -- Láº¥y coin Ä‘áº§u tiÃªn
         local coin = coins[1]
         
         -- Teleport Ä‘áº¿n coin
         local teleSuccess = teleportTo(coin.Position)
         
         if teleSuccess then
            -- Äá»£i vÃ  cáº­p nháº­t
            task.wait(0.8)
            
            -- Kiá»ƒm tra náº¿u coin cÃ²n tá»“n táº¡i
            if coin.Part and coin.Part.Parent then
               -- Thá»­ collect
               collectCoin(coin.Part)
               
               -- Cáº­p nháº­t stats
               TotalCoins = TotalCoins + 1
               CoinsInCurrentRound = CoinsInCurrentRound + 1
               
               CoinLabel:Set("Coins Farmed: " .. TotalCoins)
               RoundCoinLabel:Set("Coins in Round: " .. CoinsInCurrentRound .. "/40")
               
               print("âœ… Farmed coin! Total:", TotalCoins)
               
               -- Reset náº¿u Ä‘á»§ 40 coins
               if CoinsInCurrentRound >= 40 then
                  CoinsInCurrentRound = 0
                  TotalRounds = TotalRounds + 1
                  EXPLabel:Set("Rounds: " .. TotalRounds)
                  RoundCoinLabel:Set("Coins in Round: 0/40")
                  print("ğŸ‰ ÄÃ£ hoÃ n thÃ nh round!")
               end
            end
            
            -- Delay giá»¯a cÃ¡c láº§n farm
            task.wait(1)
         end
      end)
      
      Rayfield:Notify({
         Title = "ÄÃ£ báº¯t Ä‘áº§u",
         Content = "Farm loop Ä‘ang cháº¡y...",
         Duration = 3
      })
   end
})

Tab:CreateButton({
   Name = "â¹ï¸ Dá»ªNG FARM",
   Callback = function()
      if farmConnection then
         farmConnection:Disconnect()
         farmConnection = nil
         getgenv().AutoFarmCoins = false
         StatusLabel:Set("Status: Stopped")
         Rayfield:Notify({
            Title = "ÄÃ£ dá»«ng",
            Content = "Farm loop Ä‘Ã£ dá»«ng",
            Duration = 3
         })
      end
   end
})

-- Debug info
Tab:CreateButton({
   Name = "ğŸ“Š SHOW INFO",
   Callback = function()
      print("=== DEBUG INFO ===")
      print("Player:", player.Name)
      print("Character:", player.Character and "Exists" or "None")
      print("Coins Found:", #findCoins())
      print("In Round:", checkRound())
      print("Total Coins:", TotalCoins)
      print("Current Round Coins:", CoinsInCurrentRound)
      print("=================")
   end
})

-- Anti-AFK Ä‘Æ¡n giáº£n
task.spawn(function()
   while task.wait(30) do
      if getgenv().AntiAFKEnabled and player.Character then
         local vu = game:GetService("VirtualUser")
         vu:Button2Down(Vector2.new(0,0), Workspace.CurrentCamera.CFrame)
         task.wait(1)
         vu:Button2Up(Vector2.new(0,0), Workspace.CurrentCamera.CFrame)
      end
   end
end)

print("âœ… Script Ä‘Ã£ load xong!")
print("ğŸ‘‰ Sá»­ dá»¥ng nÃºt TEST TELEPORT trÆ°á»›c")
print("ğŸ‘‰ Sau Ä‘Ã³ dÃ¹ng Báº®T Äáº¦U FARM")
