-- Don't Steal the Baby Brainrots Script FIXED
-- Features: Auto Tele về Base & Auto Sell sau khi cướp, Auto Collect Cash, Anti-Reset WalkSpeed, Rayfield Menu
-- Cải tiến: Heartbeat loop cho WalkSpeed, Auto fire sell prompt, Tốt hơn detection

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Don't Steal the Baby Brainrots Hub FIXED",
   LoadingTitle = "Đang tải...",
   LoadingSubtitle = "by Grok - Fixed Version",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "DSTBBHubFixed",
      FileName = "Config"
   },
   Discord = {
      Enabled = false,
      Invite = "",
      RememberJoins = true
   },
   KeySystem = false
})

local MainTab = Window:CreateTab("Chính", 4483362458)
local PlayerTab = Window:CreateTab("Player")

local MainSection = MainTab:CreateSection("Tự động")

local AutoCollectToggle = MainTab:CreateToggle({
   Name = "Auto Collect Cash",
   CurrentValue = false,
   Flag = "AutoCollectCash",
   Callback = function(Value)
      getgenv().AutoCollectCash = Value
   end,
})

local AutoTeleToggle = MainTab:CreateToggle({
   Name = "Auto Tele về Base & Auto Sell sau khi cướp",
   CurrentValue = false,
   Flag = "AutoTeleBase",
   Callback = function(Value)
      getgenv().AutoTeleBase = Value
   end,
})

local TPBaseButton = MainTab:CreateButton({
   Name = "Tele về Base ngay",
   Callback = function()
      local char = player.Character
      if char and char:FindFirstChild("HumanoidRootPart") then
         local plots = workspace:FindFirstChild("Plots")
         if plots then
            local plot = plots:FindFirstChild(player.Name)
            if plot then
               local spawnPart = plot:FindFirstChild("Spawn") or plot:FindFirstChild("SpawnLocation") or plot:FindFirstChild("Baseplate") or plot.PrimaryPart or plot:FindFirstChildWhichIsA("BasePart")
               if spawnPart then
                  char.HumanoidRootPart.CFrame = spawnPart.CFrame + Vector3.new(0, 10, 0)
                  Rayfield:Notify({Title = "TP Base", Content = "Đã tele về base!", Duration = 3})
                  return
               end
            end
         end
         Rayfield:Notify({Title = "Lỗi", Content = "Không tìm thấy plot!", Duration = 3})
      end
   end,
})

local PlayerSection = PlayerTab:CreateSection("Tốc độ")

getgenv().WalkSpeedValue = 16
local WalkSpeedSlider = PlayerTab:CreateSlider({
   Name = "WalkSpeed (Anti-Reset)",
   Range = {16, 500},
   Increment = 1,
   CurrentValue = 16,
   Flag = "WalkSpeedSlider",
   Callback = function(Value)
      getgenv().WalkSpeedValue = Value
   end,
})

-- Anti-Reset WalkSpeed Loop (Heartbeat để chống reset)
local SpeedConnection
SpeedConnection = RunService.Heartbeat:Connect(function()
   local char = player.Character
   if char and char:FindFirstChild("Humanoid") then
      char.Humanoid.WalkSpeed = getgenv().WalkSpeedValue
   end
end)

-- Set WalkSpeed khi respawn
player.CharacterAdded:Connect(function(char)
   char:WaitForChild("Humanoid")
   char.Humanoid.WalkSpeed = getgenv().WalkSpeedValue
end)

-- Auto Collect Cash (Cải tiến keywords)
spawn(function()
   while task.wait(0.1) do
      if getgenv().AutoCollectCash then
         local char = player.Character
         if char and char:FindFirstChild("HumanoidRootPart") then
            for _, obj in pairs(workspace:GetDescendants()) do
               if obj:IsA("ProximityPrompt") then
                  local text = (obj.ActionText .. obj.ObjectText):lower()
                  if text:find("collect") or text:find("cash") or text:find("pick") or text:find("grab") or text:find("claim") or obj.Parent.Name:lower():find("cash") then
                     local dist = (obj.Parent.Position - char.HumanoidRootPart.Position).Magnitude
                     if dist < 80 then
                        fireproximityprompt(obj)
                     end
                  end
               end
            end
         end
      end
   end
end)

-- Auto Tele & Auto Sell sau khi cướp (Cải tiến: detect Tool, fire sell prompt)
spawn(function()
   while task.wait(0.05) do
      if getgenv().AutoTeleBase then
         local char = player.Character
         if char and char:FindFirstChild("HumanoidRootPart") and char:FindFirstChildOfClass("Tool") then
            local plots = workspace:FindFirstChild("Plots")
            if plots then
               local plot = plots:FindFirstChild(player.Name)
               if plot then
                  local deposit = plot:FindFirstChild("Deposit") or plot:FindFirstChild("Dropoff") or plot:FindFirstChild("Sell") or plot:FindFirstChild("DropZone") or plot:FindFirstChild("Pad") or plot:FindFirstChild("Spawn") or plot:FindFirstChild("SpawnLocation")
                  if deposit then
                     char.HumanoidRootPart.CFrame = CFrame.new(deposit.Position + Vector3.new(math.random(-3,3), 5, math.random(-3,3)))
                     -- Auto fire sell prompt nếu có
                     local prompt = deposit:FindFirstChildOfClass("ProximityPrompt")
                     if prompt then
                        fireproximityprompt(prompt)
                     end
                     Rayfield:Notify({Title = "Auto Sell", Content = "Đã tele & sell baby!", Duration = 2})
                     task.wait(1) -- Chờ sell xong
                  end
               end
            end
         end
      end
   end
end)

Rayfield:Notify({
   Title = "Script FIXED Loaded!",
   Content = "WalkSpeed anti-reset, Auto sell khi cướp, Collect tốt hơn. Test ngay!",
   Duration = 6,
   Image = 4483362458,
})
